(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{960:function(e,t,n){},961:function(e,t,n){},983:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(121),i=n(15),s=n(70),c=n(1),u=n.n(c),l=(n(960),function(e){var t=Object(r.useCallback)((function(){var t=e.setViewportActive;e.viewportIndex!==e.activeViewportIndex&&t()}));return Object(r.useEffect)((function(){var n=function(n){(e.onScroll(e.viewportIndex)||{}).uid===n.detail.uid&&t()};return window.addEventListener("vtkscrollevent",n),function(){return window.removeEventListener("vtkscrollevent",n)}}),[e,e.onScroll,e.viewportIndex,t]),a.a.createElement("div",{className:"vtk-viewport-handler",style:{width:"100%",height:"100%",position:"relative"},onClick:t},a.a.createElement(o.View2D,e))});l.propTypes={setViewportActive:u.a.func.isRequired,viewportIndex:u.a.number.isRequired,activeViewportIndex:u.a.number.isRequired,onScroll:u.a.func},l.defaultProps={onScroll:function(){}};var p=l;function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(n,!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=i.a.redux.actions,y=v.setViewportActive,g=v.setViewportSpecificData,b=Object(s.b)((function(e,t){var n;e.extensions&&e.extensions.vtk&&(n=e.extensions.vtk);var r=t.viewportIndex,a=r===e.viewports.activeViewportIndex,o=e.viewports.layout.viewports[r].vtk||{};return d({activeViewportIndex:e.viewports.activeViewportIndex,layout:e.viewports.layout,isActive:a},o,{},n,{enableStackPrefetch:a})}),(function(e,t){var n=t.viewportIndex;return{setViewportActive:function(){e(y(n))},setViewportSpecificData:function(t){e(g(n,t))}}}),(function(e,t,n){var r=e.afterCreation;return d({},e,{},t,{},n,{onCreated:function(e){r&&"function"==typeof r&&r(e)}})}))(p),w=(n(961),n(29));function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e,t){return(D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),S(this,O(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&D(e,t)}(t,e),n=t,(r=[{key:"render",value:function(){var e;return this.props.percentComplete&&100!==this.props.percentComplete&&(e="".concat(this.props.percentComplete,"%")),a.a.createElement(a.a.Fragment,null,this.props.error?a.a.createElement("div",{className:"imageViewerErrorLoadingIndicator loadingIndicator"},a.a.createElement("div",{className:"indicatorContents"},a.a.createElement("h4",null,"Error Loading Image"),a.a.createElement("p",{className:"description"},"An error has occurred."),a.a.createElement("p",{className:"details"},this.props.error.message))):a.a.createElement("div",{className:"imageViewerLoadingIndicator loadingIndicator"},a.a.createElement("div",{className:"indicatorContents"},a.a.createElement("p",null,this.props.t("Reformatando"),"...",a.a.createElement("i",{className:"fa fa-spin fa-circle-o-notch fa-fw"}),e))))}}])&&I(n.prototype,r),o&&I(n,o),t}(r.PureComponent);P(k,"propTypes",{percentComplete:u.a.number.isRequired,error:u.a.object}),P(k,"defaultProps",{percentComplete:0,error:null});var E=Object(w.d)("Common")(k),j=n(7),x=n.n(j),C=n(66),U=n(36);function M(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}var V=i.a.utils.StackManager;function T(e,t,n){return e.find((function(e){return e.studyInstanceUid===t})).displaySets.find((function(e){return e.displaySetInstanceUid===n}))}function F(e,t,n){return e.find((function(e){return e.studyInstanceUid===t})).displaySets.filter((function(e){return e.seriesInstanceUid===n}))}function _(e,t,n,r){var a={url:r,headers:DICOMWeb.getAuthorizationHeader()},o={studyInstanceUID:e,seriesInstanceUID:t,sopInstanceUID:n};return new U.a.DICOMwebClient(a).retrieveInstance(o)}function N(){var e;return e=regeneratorRuntime.mark((function e(t,n,r){var a,o,i,s,c,u,l,p,f,d,m,v,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.find((function(e){return e.studyInstanceUid===n})),o=T(t,n,r),i=o.images[0].getData().wadoRoot,s=o.images[0].getStudyInstanceUID(),c=o.images[0].getSeriesInstanceUID(),u=o.images[0].getSOPInstanceUID(),e.next=8,_(s,c,u,i);case 8:if(l=e.sent,p=C.b.DicomMessage.readFile(l),f=C.b.DicomMetaDictionary.naturalizeDataset(p.dict),C.a.VTKjs.Segmentation.generateSegments(f),f._meta=C.b.DicomMetaDictionary.namifyDataset(p.meta),d=f.ReferencedSeriesSequence.SeriesInstanceUID,(m=F(t,n,d)).length>1&&console.warn("More than one display set with the same seriesInstanceUid. This is not supported yet..."),(v=m[0]).images.map((function(e){return e.getImageId()})),results){e.next=20;break}throw new Error("Fractional segmentations are not supported");case 20:return y=V.findOrCreateStack(a,v),Object.assign({},y).currentImageIdIndex=0,e.abrupt("return",{referenceDataObject:referenceDataObject,labelmapDataObject:labelmapDataObject});case 25:case"end":return e.stop()}}),e)})),(N=function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){M(o,r,a,i,s,"next",e)}function s(e){M(o,r,a,i,s,"throw",e)}i(void 0)}))}).apply(this,arguments)}var R=function(e,t,n){return N.apply(this,arguments)},A=(n(13),n(147),n(562)),L=n(561);function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function H(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function K(e,t){return(K=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var J=i.a.utils.StackManager,W=new i.a.cornerstone.MetadataProvider;x.a.metaData.addProvider(W.provider.bind(W)),J.setMetadataProvider(W);var Q={SEGMENTATION_STORAGE:"1.2.840.10008.5.1.4.1.1.66.4"};({})[Q.SEGMENTATION_STORAGE]=R;var X={};var Y=function(e){function t(){var e,n,r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];return r=this,n=!(a=(e=q(t)).call.apply(e,[this].concat(s)))||"object"!==G(a)&&"function"!=typeof a?H(r):a,z(H(n),"state",{volumes:null,paintFilterLabelMapImageData:null,paintFilterBackgroundImageData:null}),z(H(n),"getViewportData",(function(e,n,r,a,i,s){var c=t.getCornerstoneStack(e,n,r,a,i,s);switch(a){case Q.SEGMENTATION_STORAGE:throw new Error("Not yet implemented");default:return Object(o.getImageData)(c.imageIds,r)}})),n}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&K(e,t)}(t,e),n=t,i=[{key:"init",value:function(){console.log("OHIFVTKViewport init()")}},{key:"destroy",value:function(){console.log("OHIFVTKViewport destroy()"),J.clearStacks()}},{key:"getCornerstoneStack",value:function(e,t,n,r,a){var o=e.find((function(e){return e.studyInstanceUid===t})),i=o.displaySets.find((function(e){return e.displaySetInstanceUid===n})),s=J.findOrCreateStack(o,i),c=Object.assign({},s);if(void 0!==a)c.currentImageIdIndex=a;else if(r){var u=c.imageIds.findIndex((function(e){var t=x.a.metaData.get("sopCommonModule",e);if(t)return t.sopInstanceUID===r}));u>-1&&(c.currentImageIdIndex=u)}else c.currentImageIdIndex=0;return c}}],(r=[{key:"getOrCreateVolume",value:function(e,t){if(X[t])return X[t];var n=e.vtkImageData,r=e.imageMetaData0,a=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return isNaN(t)||isNaN(e)?{lower:0,upper:512}:"PT"===n?{lower:0,upper:5}:{lower:t-e/2,upper:t+e/2}}(r.windowWidth,r.windowCenter,r.modality),o=a.lower,i=a.upper,s=A.default.newInstance(),c=L.default.newInstance();s.setMapper(c),c.setInputData(n),s.getProperty().getRGBTransferFunction(0).setRange(o,i);var u=n.getSpacing(),l=(u[0]+u[1]+u[2])/6;return c.setSampleDistance(l),c.setMaximumSamplesPerRay(4e3),X[t]=s,s}},{key:"setStateFromProps",value:function(){var e=this,t=this.props.viewportData,n=t.studies,r=t.displaySet,a=r.studyInstanceUid,o=r.displaySetInstanceUid,i=r.sopClassUids,s=r.sopInstanceUid,c=r.frameIndex;i.length>1&&console.warn("More than one SOPClassUid in the same series is not yet supported.");var u=i[0],l=this.getViewportData(n,a,o,u,s,c);this.imageDataObject=l;var p=this.getOrCreateVolume(l,o);this.setState({paintFilterBackgroundImageData:l.vtkImageData,paintFilterLabelMapImageData:null,percentComplete:0}),this.setState({paintFilterBackgroundImageData:l.vtkImageData,paintFilterLabelMapImageData:null,percentComplete:0},(function(){e.loadProgressively(l),setTimeout((function(){e.setState({volumes:[p]})}),200)}))}},{key:"componentDidMount",value:function(){this.setStateFromProps()}},{key:"componentDidUpdate",value:function(e){var t=this.props.viewportData,n=(t.studies,t.displaySet),r=e.viewportData.displaySet;n.displaySetInstanceUid===r.displaySetInstanceUid&&n.sopInstanceUid===r.sopInstanceUid&&n.frameIndex===r.frameIndex||this.setStateFromProps()}},{key:"loadProgressively",value:function(e){var t=this;Object(o.loadImageData)(e);var n=e.isLoading,r=e.insertPixelDataPromises,a=r.length;n?(r.forEach((function(e){e.then((function(e){var n=Math.floor(100*e/a);n!==t.state.percentComplete&&t.setState({percentComplete:n})}))})),Promise.all(r).then((function(){t.setState({isLoaded:!0})}))):this.setState({isLoaded:!0})}},{key:"render",value:function(){var e=this,t=null;return this.props.children&&this.props.children.length&&(t=this.props.children.map((function(t,n){return t&&a.a.cloneElement(t,{viewportIndex:e.props.viewportIndex,key:n})}))),a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{style:{width:"100%",height:"100%",position:"relative"}},!this.state.isLoaded&&a.a.createElement(E,{percentComplete:this.state.percentComplete}),this.state.volumes&&a.a.createElement(b,{volumes:this.state.volumes,paintFilterLabelMapImageData:this.state.paintFilterLabelMapImageData,paintFilterBackgroundImageData:this.state.paintFilterBackgroundImageData,viewportIndex:this.props.viewportIndex,onScroll:this.props.onScroll})),")}",t)}}])&&B(n.prototype,r),i&&B(n,i),t}(r.Component);z(Y,"propTypes",{viewportData:u.a.shape({studies:u.a.array,displaySet:u.a.shape({studyInstanceUid:u.a.string,displaySetInstanceUid:u.a.string,sopClassUids:u.a.arrayOf(u.a.string),sopInstanceUid:u.a.string,frameIndex:u.a.number})}),viewportIndex:u.a.number,children:u.a.node,onScroll:u.a.func}),z(Y,"defaultProps",{onScroll:function(){}}),z(Y,"id","OHIFVTKViewport");t.default=Y}}]);
//# sourceMappingURL=OHIFVTKViewport.bundle.40a41e2fcd5c0e9907e8.js.map