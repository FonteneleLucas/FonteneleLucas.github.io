(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{986:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),a=n(939),i=n.n(a),s=n(15),c=n(70),u=n(181),p=n.n(u),d=n(45);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=s.a.redux.actions,y=v.setViewportActive,m=v.setViewportSpecificData,w=s.a.measurements.MeasurementHandlers,b=w.onAdded,h=w.onRemoved,I=w.onModified,g={added:b,removed:h,modified:p()((function(e){return I(e)}),300)},S=Object(c.b)((function(e,t){var n;e.extensions&&e.extensions.cornerstone&&(n=e.extensions.cornerstone);var r=t.viewportIndex,o=r===e.viewports.activeViewportIndex,a=e.viewports.viewportSpecificData[r]||{},i=!1,s=24;if(a&&a.cine){var c=a.cine;i=!0===c.isPlaying,s=c.cineFrameRate||s}return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(n,!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({isActive:o},n,{isStackPrefetchEnabled:o,isPlaying:i,frameRate:s})}),(function(e,t){var n=t.viewportIndex;return{setViewportActive:function(){e(y(n))},setViewportSpecificData:function(t){e(m(n,t))},onElementEnabled:function(t){var r=t.detail.element;Object(d.b)(n,r),e(m(n,{plugin:"cornerstone"}))},onMeasurementsChanged:function(e,t){return g[t](e)}}}))(i.a),O=n(1),D=n.n(O),P=n(7),x=n.n(P),k=n(66),E=n(11),j=n.n(E);function U(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}var M=s.a.utils,T=M.StackManager,C=M.DicomLoaderService;function A(e,t,n){return e.find((function(e){return e.studyInstanceUid===t})).displaySets.find((function(e){return e.displaySetInstanceUid===n}))}function R(e,t,n){return e.find((function(e){return e.studyInstanceUid===t})).displaySets.filter((function(e){return e.seriesInstanceUid===n}))}function _(e,t){return k.a.Cornerstone.Segmentation.generateToolState(t,e,x.a.metaData)}function F(){var e;return e=regeneratorRuntime.mark((function e(t,n,r){var o,a,i,s,c,u,p,d,f,l,v,y,m,w,b;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.find((function(e){return e.studyInstanceUid===n})),a=A(t,n,r),e.next=4,C.findDicomDataPromise(a,t);case 4:if(i=e.sent,s=k.b.DicomMessage.readFile(i),(c=k.b.DicomMetaDictionary.naturalizeDataset(s.dict))._meta=k.b.DicomMetaDictionary.namifyDataset(s.meta),u=c.ReferencedSeriesSequence.SeriesInstanceUID,(p=R(t,n,u)).length>1&&console.warn("More than one display set with the same seriesInstanceUid. This is not supported yet..."),d=p[0],f=d.images.map((function(e){return e.getImageId()})),l=_(i,f)){e.next=16;break}throw new Error("Fractional segmentations are not supported");case 16:return v=l.labelmapBuffer,y=l.segMetadata,m=l.segmentsOnFrame,j.a.getModule("segmentation").setters.labelmap3DByFirstImageId(f[0],v,0,y,f.length,m),w=T.findOrCreateStack(o,d),(b=Object.assign({},w)).currentImageIdIndex=0,e.abrupt("return",{studyInstanceUid:n,displaySetInstanceUid:r,stack:b});case 23:case"end":return e.stop()}}),e)})),(F=function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){U(a,r,o,i,s,"next",e)}function s(e){U(a,r,o,i,s,"throw",e)}i(void 0)}))}).apply(this,arguments)}var V=function(e,t,n){return F.apply(this,arguments)};function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function N(){return(N=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function H(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function J(e){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var K=s.a.utils.StackManager,Q=new s.a.cornerstone.MetadataProvider;x.a.metaData.addProvider(Q.provider.bind(Q)),K.setMetadataProvider(Q);var W={SEGMENTATION_STORAGE:"1.2.840.10008.5.1.4.1.1.66.4"},X={};X[W.SEGMENTATION_STORAGE]=V;var Y=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return r=this,n=!(o=(e=J(t)).call.apply(e,[this].concat(i)))||"object"!==G(o)&&"function"!=typeof o?q(r):o,L(q(n),"state",{viewportData:null}),L(q(n),"getViewportData",function(){var e,n=(e=regeneratorRuntime.mark((function e(n,r,o,a,i,s){var c,u,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=a,e.next=e.t0===W.SEGMENTATION_STORAGE?3:8;break;case 3:return u=X[W.SEGMENTATION_STORAGE],e.next=6,u(n,r,o,i,s);case 6:return c=e.sent,e.abrupt("break",11);case 8:return p=t.getCornerstoneStack(n,r,o,i,s),c={studyInstanceUid:r,displaySetInstanceUid:o,stack:p},e.abrupt("break",11);case 11:return e.abrupt("return",c);case 12:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){H(a,r,o,i,s,"next",e)}function s(e){H(a,r,o,i,s,"throw",e)}i(void 0)}))});return function(e,t,r,o,a,i){return n.apply(this,arguments)}}()),n}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(t,e),n=t,a=[{key:"init",value:function(){console.log("OHIFCornerstoneViewport init()")}},{key:"destroy",value:function(){console.log("OHIFCornerstoneViewport destroy()"),K.clearStacks()}},{key:"getCornerstoneStack",value:function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!e||!e.length)throw new Error("Studies not provided.");if(!t)throw new Error("StudyInstanceUID not provided.");if(!n)throw new Error("StudyInstanceUID not provided.");var a=e.find((function(e){return e.studyInstanceUid===t}));if(!a)throw new Error("Study not found.");var i=a.displaySets.find((function(e){return e.displaySetInstanceUid===n}));if(!i)throw new Error("Display Set not found.");var s=K.findOrCreateStack(a,i),c=Object.assign({},s);if(c.currentImageIdIndex=o,r){var u=c.imageIds.findIndex((function(e){var t=x.a.metaData.get("sopCommonModule",e);if(t)return t.sopInstanceUID===r}));u>-1?c.currentImageIdIndex=u:console.warn("SOPInstanceUID provided was not found in specified DisplaySet")}return c}}],(r=[{key:"setStateFromProps",value:function(){var e=this,t=this.props.viewportData,n=t.studies,r=t.displaySet,o=r.studyInstanceUid,a=r.displaySetInstanceUid,i=r.sopClassUids,s=r.sopInstanceUid,c=r.frameIndex;if(o&&a){i&&i.length>1&&console.warn("More than one SOPClassUid in the same series is not yet supported.");var u=i&&i[0];this.getViewportData(n,o,a,u,s,c).then((function(t){e.setState({viewportData:t})}))}}},{key:"componentDidMount",value:function(){this.setStateFromProps()}},{key:"componentDidUpdate",value:function(e){var t=this.props.viewportData,n=(t.studies,t.displaySet),r=e.viewportData.displaySet;n.displaySetInstanceUid===r.displaySetInstanceUid&&n.sopInstanceUid===r.sopInstanceUid&&n.frameIndex===r.frameIndex||this.setStateFromProps()}},{key:"render",value:function(){var e=this,t=null;if(!this.state.viewportData)return null;var n=this.props.viewportIndex,r=this.state.viewportData.stack,a=r.imageIds,i=r.currentImageIdIndex;return this.props.children&&this.props.children.length&&(t=this.props.children.map((function(t,n){return t&&o.a.cloneElement(t,{viewportIndex:e.props.viewportIndex,key:n})}))),o.a.createElement(o.a.Fragment,null,o.a.createElement(S,N({viewportIndex:n,imageIds:a,imageIdIndex:i},this.props.customProps)),t)}}])&&B(n.prototype,r),a&&B(n,a),t}(r.Component);L(Y,"defaultProps",{customProps:{}}),L(Y,"propTypes",{studies:D.a.object,displaySet:D.a.object,viewportIndex:D.a.number,children:D.a.node,customProps:D.a.object}),L(Y,"id","OHIFCornerstoneViewport");t.default=Y}}]);
//# sourceMappingURL=OHIFCornerstoneViewport.bundle.9d999b50ff43c57eb523.js.map